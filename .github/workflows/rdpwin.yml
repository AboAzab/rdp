name: Direct RDP (No Tunnel)

on: [workflow_dispatch]

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 360
    steps:
      - name: Setup RDP
        run: |
          net user kame23 S5316875844@a /add
          net localgroup administrators kame23 /add
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name 'fDenyTSConnections' -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          Set-Service -Name "TermService" -StartupType Automatic
          Start-Service -Name "TermService"
          Start-Sleep -Seconds 10

      - name: Get Public IP
        run: |
          $ip = (Invoke-WebRequest -Uri "https://api.ipify.org").Content
          Write-Host "=========================================="
          Write-Host "PUBLIC IP: $ip"
          Write-Host "Connect to: $ip:3389"
          Write-Host "Username: kame23"
          Write-Host "Password: S5316875844@a"
          Write-Host "=========================================="

      - name: Keep alive
        run: |
          while ($true) {
            Start-Sleep -Seconds 300
            Write-Host "Active"
          }
